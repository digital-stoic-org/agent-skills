# Manifest Format: .ctx/manifest.yaml

## Purpose

The manifest file organizes unstructured source files with priorities and tags for context management. It lives in `.ctx/` as part of the actionable snapshot.

## Location

`.ctx/manifest.yaml` (auto-generated by `/create-context`, user-editable)

## Folder Architecture

| Folder | Role | Mutable by commands? |
|--------|------|---------------------|
| `.in/` | Bootstrap - user dumps raw docs here | ❌ Never modified |
| `.ctx/` | Actionable snapshot - processed context | ✅ Generated/regenerated |

The manifest references files in `.in/` but lives in `.ctx/` because it's part of the processed snapshot.

## Schema

```yaml
project: string                    # Project name (auto-inferred from directory)
created: ISO8601                  # Timestamp of creation
source_folder: .in/               # Reference to immutable bootstrap folder

sources:
  high:                           # HIGH priority files (≤1500 tokens inline, >1500 summarized)
    - file: string                 # Path relative to .in/ directory
      desc: string                 # Human-readable description
      action: inline|summarized   # How file is processed (auto-set based on size)
  medium:                         # MEDIUM priority files (≤2500 tokens inline, >2500 summarized)
    - file: string
      desc: string
      action: inline|summarized
  low:                            # LOW priority files (reference only, no content copied)
    - file: string
      desc: string

tags:                             # Optional categorization (user-editable)
  category_name: [file1, file2]   # Category → file list mapping
```

## Examples

### Minimal Example

```yaml
project: my-training-project
created: 2026-01-23T10:30:00Z
source_folder: .in/

sources:
  high:
    - file: proposal.md
      desc: Main training objectives and deliverables
      action: inline
    - file: client-brief.md
      desc: Client requirements and constraints
      action: inline

  medium:
    - file: style-guide.md
      desc: Homo Promptus tone and style reference
      action: summarized

  low:
    - file: old-notes.md
      desc: Background research from discovery phase
```

### Full Example with Tags

```yaml
project: context-management
created: 2026-01-23T15:47:00Z
source_folder: .in/

sources:
  high:
    - file: 20260107_102932_model-selection-clarification.md
      desc: Model selection strategy discussion
      action: inline
    - file: 20260107_103920_context-cost-realization.md
      desc: Token cost analysis and implications
      action: summarized

  medium:
    - file: 20260107_104238_compact-vs-exit.md
      desc: Compact mode vs exit optimization comparison
      action: inline
    - file: google-in/imported-slides.md
      desc: Imported presentation from Google Drive
      action: summarized

  low:
    - file: 20260107_105911_thinking-impact-analysis.md
      desc: Thinking tokens impact reference

tags:
  optimization: [20260107_102932_model-selection-clarification.md, 20260107_103920_context-cost-realization.md]
  analysis: [20260107_103804_token-threshold-exploration.md, 20260107_105911_thinking-impact-analysis.md]
  client-facing: [google-in/imported-slides.md]
```

### Subdirectory Example

```yaml
project: training-delivery
created: 2026-01-23T16:00:00Z
source_folder: .in/

sources:
  high:
    - file: google-in/mazette-briefing.md
      desc: Mazette project requirements from client
      action: inline
    - file: google-in/scenarios/business-analyser.md
      desc: Business ANALYSER scenario template
      action: inline

  medium:
    - file: reference/risen-template.md
      desc: RISEN prompt structure reference
      action: inline
    - file: google-in/scenarios/tech-decider.md
      desc: Tech DÉCIDER scenario template
      action: inline

  low: []

tags:
  scenarios: [google-in/scenarios/business-analyser.md, google-in/scenarios/tech-decider.md]
  templates: [reference/risen-template.md]
```

## Validation Rules

1. **Required fields**:
   - `project` (string, non-empty)
   - `created` (ISO 8601 timestamp)
   - `source_folder` (string, typically `.in/`)
   - `sources` (object with high/medium/low keys)

2. **File paths**:
   - Must be relative to `source_folder` (`.in/`)
   - Must exist when manifest is generated
   - Can include subdirectories (e.g., `google-in/file.md`)

3. **Descriptions**:
   - Required for each source file
   - Must be non-empty strings
   - Should be concise (1-2 sentences)

4. **Action field** (HIGH/MEDIUM only):
   - `inline`: Content embedded directly in baseline
   - `summarized`: Summary generated in `.ctx/01-*-summary-llm.md`
   - Auto-set based on token thresholds, but user can override

5. **Tags** (optional):
   - Keys: category names (alphanumeric, hyphens, underscores)
   - Values: arrays of file paths matching `sources` entries

6. **Priority sections**:
   - All three (high/medium/low) must be present
   - Can be empty arrays: `high: []`

## Context Sizing Behavior

| Priority | Token Count | Action |
|----------|-------------|--------|
| HIGH | ≤1500 | Copy to `.ctx/`, inline in baseline |
| HIGH | >1500, ≤25K | Copy to `.ctx/`, summarize directly |
| HIGH | >25K | Copy to `.ctx/`, summarize via sub-agent |
| MEDIUM | ≤2500 | Copy to `.ctx/`, inline in baseline |
| MEDIUM | >2500, ≤25K | Copy to `.ctx/`, summarize directly |
| MEDIUM | >25K | Copy to `.ctx/`, summarize via sub-agent |
| LOW | any | Reference only (path to `.in/`, no copy) |

**Token estimation**: `tokens ≈ words / 0.75` (using `wc -w`)

**25K limit**: Claude Code's Read tool has a ~25K token limit. Files exceeding this are processed by the `summarize-for-context` sub-agent using chunked reads.

## Usage in RISEN Prompts

The manifest generates copy-paste ready INPUT tables:

```markdown
## INPUT

| Priority | File | Description |
|----------|------|-------------|
| 1 (HIGH) | @.ctx/proposal.md | Main training objectives |
| 1 (HIGH) | @.ctx/client-brief.md | Client requirements |
| 2 (MED) | @.ctx/style-guide.md | HP tone reference |
| 3 (LOW) | @.in/old-notes.md | Background research (ref only) |
```

**Note**: HIGH/MEDIUM files reference `.ctx/` (copied files), LOW files reference `.in/` (source only).

## Editing Guidelines

**Safe to edit**:
- ✅ Descriptions (`desc` fields)
- ✅ Tags section (add/remove categories)
- ✅ Priority reassignment (move files between high/medium/low)
- ✅ Action field (force `inline` or `summarized`)

**Do not edit**:
- ❌ `project` name (affects baseline generation)
- ❌ `created` timestamp (historical record)
- ❌ `source_folder` (must be `.in/`)
- ❌ File paths (must match actual files in `.in/`)

**After editing**:
Re-run `/create-context --force` to regenerate `.ctx/` snapshot and baseline with updated priorities.

## Security

Files matching these patterns are **automatically skipped**:
- `.env*`
- `*credentials*`
- `*secrets*`
- `*token*`
- `*.key`, `*.pem`, `*.crt`

See `CLAUDE.md` security section for full exclusion list.
